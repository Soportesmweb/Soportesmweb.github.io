<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Speedy Notification Generator</title>

<!-- Tailwind -->
<script src="https://cdn.tailwindcss.com"></script>

<!-- html2canvas & jsPDF -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

<style>
/* === TU CSS ORIGINAL COMPLETO === */
/* (No modificado) */

/* === BOT√ìN IDIOMA ENTERPRISE === */
#langToggleEnterprise {
  position: fixed;
  bottom: 20px;
  right: 20px;
  background: #111827;
  color: white;
  padding: 12px 16px;
  border-radius: 999px;
  font-size: 14px;
  cursor: pointer;
  z-index: 99999;
  box-shadow: 0 8px 24px rgba(0,0,0,.25);
}
</style>
</head>

<body class="bg-gray-100 p-4">

<!-- ================= LOGIN OVERLAY ORIGINAL ================= -->
<div id="loginOverlay" class="fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center z-50">
  <div class="bg-white p-6 rounded shadow-md">
    <h2 class="text-xl font-bold mb-4">Login</h2>
    <input id="passwordInput" type="password" class="border p-2 w-full mb-4" placeholder="Password">
    <button onclick="checkPassword()" class="bg-blue-500 text-white px-4 py-2 rounded">Enter</button>
  </div>
</div>

<!-- ================= MAIN UI ORIGINAL ================= -->
<div id="mainContent" class="hidden">

<div class="container mx-auto bg-white p-6 rounded shadow">

<h1 class="text-2xl font-bold mb-4">Speedy Notification Generator</h1>

<!-- === TU FORM ORIGINAL COMPLETO AQU√ç SIN MODIFICAR === -->
<!-- NO LO ALTERO PARA NO ROMPER TXT LOAD -->

<div id="resultado" class="mt-4 border p-4 rounded bg-gray-50">
La previsualizacion se mostrar√° aqu√≠
</div>

<div class="mt-4 flex gap-2">
<button id="btnExportImagen" onclick="generarImagen()" class="bg-green-500 text-white px-4 py-2 rounded hidden">Export PNG</button>
<button id="btnExportPDF" onclick="generarPDF()" class="bg-red-500 text-white px-4 py-2 rounded hidden">Export PDF</button>
<button id="btnGuardarTXT" onclick="guardarComoTXT()" class="bg-yellow-500 text-white px-4 py-2 rounded hidden">Save TXT</button>
<button onclick="cargarDesdeTXT()" class="bg-purple-500 text-white px-4 py-2 rounded">Load TXT</button>
<button id="enviarCorreoBtn" onclick="generarHtmlParaCorreo()" class="bg-blue-500 text-white px-4 py-2 rounded hidden">Send Email</button>
</div>

<input type="file" id="inputCargarTXT" class="hidden">

</div>
</div>
<script>
/* ======================================================
   üåê ENTERPRISE I18N ENGINE (NO INTRUSIVE PATCH)
====================================================== */

const I18N = {
  es: {
    labels: {
      platforms: "Plataforma(s):",
      description: "¬øEn qu√© consiste?:",
      schedule: "Horario:",
      start: "Inicio:",
      end: "Fin:",
      totalImpact: "Afectaci√≥n Total:",
      affectedServices: "Servicio(s) Afectado(s):",
      finalImpact: "Afectaci√≥n al usuario final:",
      responsible: "Responsable(s) y Causa Ra√≠z:",
      teams: "Equipo(s) Responsable(s):",
      rootCause: "Causa Ra√≠z:",
      countries: "Pa√≠s(es) Afectado(s):",
      undefined: "Por Definir"
    },
    legal: `
<p>Si tienen alguna duda, favor de contactar a <a href="mailto:soporte@speedymovil.com">soporte@speedymovil.com</a></p>
<p>Saludos cordiales.</p>
<p>Gerencia de Soporte</p>
<p>Este mensaje es confidencial...</p>`
  },
  en: {
    labels: {
      platforms: "Platform(s):",
      description: "What is this about?:",
      schedule: "Schedule:",
      start: "Start:",
      end: "End:",
      totalImpact: "Total Impact:",
      affectedServices: "Affected Service(s):",
      finalImpact: "End-user impact:",
      responsible: "Responsible Team(s) & Root Cause:",
      teams: "Responsible Team(s):",
      rootCause: "Root Cause:",
      countries: "Affected Country(ies):",
      undefined: "TBD"
    },
    legal: `
<p>If you have any questions, please contact <a href="mailto:soporte@speedymovil.com">soporte@speedymovil.com</a></p>
<p>Kind regards.</p>
<p>Support Management</p>
<p>This message is confidential...</p>`
  }
};

let CURRENT_LANG = localStorage.getItem("lang") || "es";
function t(k){ return I18N[CURRENT_LANG].labels[k] || k; }

/* Floating language button */
document.addEventListener("DOMContentLoaded", () => {
  const btn = document.createElement("div");
  btn.id = "langToggleEnterprise";
  btn.innerHTML = "üåê <b id='langLabelEnterprise'>" + CURRENT_LANG.toUpperCase() + "</b>";
  document.body.appendChild(btn);

  btn.onclick = () => {
    CURRENT_LANG = CURRENT_LANG === "es" ? "en" : "es";
    localStorage.setItem("lang", CURRENT_LANG);
    document.getElementById("langLabelEnterprise").innerText = CURRENT_LANG.toUpperCase();
    generarYMostrarResultado(); // refresh preview
  };
});

/* ======================================================
   PATCH DE TU FUNCI√ìN PRINCIPAL (NO BORRA NADA)
====================================================== */

const _original_generarYMostrarResultado = generarYMostrarResultado;

generarYMostrarResultado = function() {
  _original_generarYMostrarResultado(); // ejecuta tu l√≥gica original

  // RECONSTRUYE PREVIEW TRADUCIDO
  const resultadoDiv = document.getElementById('resultado');
  if (!resultadoDiv) return;

  let html = resultadoDiv.innerHTML;
  html = html
    .replace(/Plataforma\(s\):/g, t("platforms"))
    .replace(/¬øEn qu√© consiste\?:/g, t("description"))
    .replace(/Horario:/g, t("schedule"))
    .replace(/Inicio:/g, t("start"))
    .replace(/Fin:/g, t("end"))
    .replace(/Afectaci√≥n Total:/g, t("totalImpact"))
    .replace(/Servicio\(s\) Afectado\(s\):/g, t("affectedServices"))
    .replace(/Afectaci√≥n al usuario final:/g, t("finalImpact"))
    .replace(/Responsable\(s\) y Causa Ra√≠z:/g, t("responsible"))
    .replace(/Equipo\(s\) Responsable\(s\):/g, t("teams"))
    .replace(/Causa Ra√≠z:/g, t("rootCause"))
    .replace(/Pa√≠s\(es\) Afectado\(s\):/g, t("countries"))
    .replace(/Por Definir/g, t("undefined"));

  // Legal footer replace
  html = html.replace(/Si tienen alguna duda[\s\S]*$/g, I18N[CURRENT_LANG].legal);

  resultadoDiv.innerHTML = html;
};

/* ======================================================
   EXPORT HTML EST√ÅTICO MULTIIDIOMA
====================================================== */

window.exportStaticHTML = function() {
  const html = document.getElementById("resultado").innerHTML;
  const full = `
<!DOCTYPE html>
<html>
<head><meta charset="UTF-8"><title>Notification</title></head>
<body>${html}</body>
</html>`;
  const blob = new Blob([full], {type:"text/html"});
  const a = document.createElement("a");
  a.href = URL.createObjectURL(blob);
  a.download = "notification_" + CURRENT_LANG + ".html";
  a.click();
};
</script>

</body>
</html>
