<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Generador de Notificaciones</title>

<!-- Tailwind -->
<script src="https://cdn.tailwindcss.com"></script>

<!-- Export -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

<style>

/* ===== TU CSS ORIGINAL ===== */

#resultado {
    background: url('fondomsco.png') center center no-repeat;
    background-size: cover;
}

.preview-grid-cell {
    background-color: rgba(255,255,255,0.85);
}

/* (TODO tu CSS original va aqu√≠ SIN CAMBIOS) */

</style>
</head>

<body class="bg-gray-100 p-4">

<div class="max-w-7xl mx-auto bg-white p-6 rounded-lg shadow-lg">
<h1 class="text-3xl font-bold mb-4" data-i18n="Generador de Notificaciones Interactivo">Generador de Notificaciones Interactivo</h1>

<!-- Selector idioma -->
<div class="mb-4">
<label class="font-semibold">Idioma:</label>
<select id="langSelector" class="border p-2 rounded">
<option value="es">Espa√±ol</option>
<option value="en">English</option>
</select>
</div>
<script>
/* ===== GLOBAL LANG ===== */
window.__CURRENT_LANG = "es";

/* UI Translation Dictionary */
const I18N = {
  es: {
    "Generador de Notificaciones Interactivo":"Generador de Notificaciones Interactivo"
  },
  en: {
    "Generador de Notificaciones Interactivo":"Interactive Notification Generator"
  }
};

/* Apply UI translation */
function i18nApply(lang) {
  localStorage.setItem("lang", lang);
  window.__CURRENT_LANG = lang;
  document.documentElement.lang = lang;

  const dict = I18N[lang];
  document.querySelectorAll("[data-i18n]").forEach(el=>{
    const key = el.getAttribute("data-i18n");
    if(dict[key]) el.innerText = dict[key];
  });
}

/* Detect language */
function detectLang() {
  const stored = localStorage.getItem("lang");
  if(stored) return stored;
  return navigator.language.startsWith("es") ? "es" : "en";
}

document.addEventListener("DOMContentLoaded", ()=>{
  const sel = document.getElementById("langSelector");
  const lang = detectLang();
  sel.value = lang;
  i18nApply(lang);
  sel.addEventListener("change", e=>{
    i18nApply(e.target.value);
    generarYMostrarResultado(); // refresh preview
  });
});
</script>
<script>
const PREVIEW_I18N = {
  "Horario":"Schedule",
  "Hora de Inicio":"Start Time",
  "Hora de Fin":"End Time",
  "Afectaci√≥n Total":"Total Impact",
  "Sin Afectaci√≥n":"No Impact",
  "Equipo Responsable":"Responsible Team",
  "Servicios Afectados":"Affected Services",
  "Causa Ra√≠z":"Root Cause",
  "Afectaci√≥n al usuario final":"End User Impact",
  "Pa√≠ses Afectados":"Affected Countries",
  "Plataforma":"Platform",
  "Tipo de Notificaci√≥n":"Notification Type",
  "Descripci√≥n":"Description",
  "Consideraciones":"Considerations"
};

/* Safe DOM translator */
function translatePreviewDOM() {
  if(window.__CURRENT_LANG !== "en") return;
  const res = document.getElementById("resultado");
  if(!res) return;

  const walker = document.createTreeWalker(res, NodeFilter.SHOW_TEXT);
  let node;
  while(node = walker.nextNode()){
    const t = node.nodeValue.trim();
    if(PREVIEW_I18N[t]) node.nodeValue = PREVIEW_I18N[t];
  }
}

/* Observe preview changes */
document.addEventListener("DOMContentLoaded", ()=>{
  const res = document.getElementById("resultado");
  if(!res) return;
  const obs = new MutationObserver(()=> translatePreviewDOM());
  obs.observe(res, {childList:true, subtree:true});
});
</script>
<!-- ================= FORMULARIO ORIGINAL ================= -->
<!-- AQU√ç VA TU FORMULARIO COMPLETO SIN CAMBIOS -->
<!-- NO lo modifiqu√© para no romper IDs ni l√≥gica -->
<!-- ======================================================= -->

<hr class="my-10 border-t-2 border-gray-200" />

<h2 class="text-2xl font-bold text-gray-800 mb-6 text-center" data-i18n="Previsualizaci√≥n de Notificaci√≥n">
Previsualizaci√≥n de Notificaci√≥n
</h2>

<div id="resultado" class="p-4 min-h-[300px] border rounded bg-white shadow">
<p class="text-gray-500 text-center">La previsualizaci√≥n se mostrar√° aqu√≠.</p>
</div>

<!-- ================= BOTONES ================= -->
<div class="flex justify-center items-center flex-wrap gap-4 mt-8 bg-purple-200 p-6 rounded-lg shadow-inner">

<button onclick="generarYMostrarResultado()" class="bg-blue-600 text-white px-4 py-2 rounded">
Generar Notificaci√≥n y Previsualizar
</button>

<button onclick="generarHtmlParaCorreo()" class="bg-green-600 text-white px-4 py-2 rounded">
Genera Correo para Vo.Bo.
</button>

<button id="btnExportImagen" onclick="generarImagen()" class="bg-orange-600 text-white px-4 py-2 rounded hidden">
Exportar Imagen
</button>

<button id="btnExportPDF" onclick="generarPDF()" class="bg-red-600 text-white px-4 py-2 rounded hidden">
Exportar PDF
</button>

<button id="btnGuardarTXT" onclick="guardarComoTXT()" class="bg-gray-700 text-white px-4 py-2 rounded hidden">
Guardar TXT
</button>

<button onclick="document.getElementById('inputCargarTXT').click()" class="bg-black text-white px-4 py-2 rounded">
Cargar TXT
</button>

<input type="file" id="inputCargarTXT" accept=".txt" hidden />

</div>

<!-- ================= GENERADOR PREVIEW (FIXED) ================= -->
<script>
/* 
  ESTA ES TU FUNCI√ìN ORIGINAL PERO CON FIX INTEGRADO
  No toco tu armado HTML, solo agrego traducci√≥n segura
*/

function generarYMostrarResultado() {

    /* ======= TU BLOQUE ORIGINAL DE ARMADO HTML ======= */
    /* EJEMPLO:
       let htmlPreview = `
         <div class="grid ...">...</div>
       `;
    */

    let htmlPreview = construirHTMLPreview(); // üëâ Si ya tienes esta funci√≥n, mantenla

    /* =============================================== */

    const resultado = document.getElementById("resultado");
    resultado.innerHTML = htmlPreview;

    // === FIX CR√çTICO PARA INGL√âS ===
    // Traduce SOLO el preview ya renderizado (DOM-safe)
    if (window.__CURRENT_LANG === "en") {
        translatePreviewDOM();
    }

    // Mostrar botones exportaci√≥n
    document.getElementById("btnExportImagen").classList.remove("hidden");
    document.getElementById("btnExportPDF").classList.remove("hidden");
    document.getElementById("btnGuardarTXT").classList.remove("hidden");
}
</script>
<script>
function construirHTMLPreview() {

  // EJEMPLO BASE (reemplaza con TU c√≥digo real)
  return `
  <div class="grid grid-cols-2 gap-2 text-sm">
    <div class="font-bold">Horario</div>
    <div>${document.getElementById("horario").value}</div>

    <div class="font-bold">Hora de Inicio</div>
    <div>${document.getElementById("horaInicio").value}</div>

    <div class="font-bold">Hora de Fin</div>
    <div>${document.getElementById("horaFin").value}</div>
  </div>
  `;
}
</script>
<!-- ================== EXPORTACI√ìN IMAGEN ================== -->
<script>
function construirNombreArchivo() {
    const now = new Date();
    return `Notificacion_${now.getFullYear()}-${now.getMonth()+1}-${now.getDate()}_${now.getHours()}h${now.getMinutes()}m`;
}

function generarImagen() {
    const resultado = document.getElementById("resultado");
    if (!resultado) return alert("Primero genera la notificaci√≥n");

    const nombre = construirNombreArchivo();

    html2canvas(resultado, {
        scale: 2,
        useCORS: true,
        backgroundColor: "#ffffff"
    }).then(canvas => {
        const link = document.createElement("a");
        link.download = nombre + ".png";
        link.href = canvas.toDataURL("image/png");
        link.click();
    });
}
</script>

<!-- ================== EXPORTACI√ìN PDF ================== -->
<script>
async function generarPDF() {
    const resultado = document.getElementById("resultado");
    if (!resultado) return alert("Primero genera la notificaci√≥n");

    const nombre = construirNombreArchivo();
    const { jsPDF } = window.jspdf;

    const canvas = await html2canvas(resultado, {
        scale: 2,
        useCORS: true,
        backgroundColor: "#ffffff"
    });

    const imgData = canvas.toDataURL("image/png");
    const pdf = new jsPDF("p", "mm", "a4");

    const pageWidth = pdf.internal.pageSize.getWidth();
    const pageHeight = pdf.internal.pageSize.getHeight();
    const ratio = pageWidth / canvas.width;
    const imgHeight = canvas.height * ratio;

    pdf.addImage(imgData, "PNG", 0, 0, pageWidth, imgHeight);
    pdf.save(nombre + ".pdf");
}
</script>

---

# ‚úÖ GENERAR HTML PARA CORREO (Vo.Bo.)

```html
<script>
function generarHtmlParaCorreo() {
    const resultado = document.getElementById("resultado");
    if (!resultado) return alert("Primero genera la notificaci√≥n");

    let htmlCorreo = `
<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Notificaci√≥n</title>
</head>
<body style="font-family:Arial, sans-serif;">
${resultado.innerHTML}
</body>
</html>
`;

    // Descarga autom√°tica
    const blob = new Blob([htmlCorreo], { type: "text/html" });
    const url = URL.createObjectURL(blob);
    const a = document.createElement("a");
    a.href = url;
    a.download = construirNombreArchivo() + "_correo.html";
    a.click();
}
</script>
<script>
function guardarComoTXT() {
    const inputs = document.querySelectorAll("input, textarea, select");
    const data = {};

    inputs.forEach(el => {
        if (el.id) data[el.id] = el.value;
    });

    const blob = new Blob([JSON.stringify(data, null, 2)], { type: "text/plain" });
    const url = URL.createObjectURL(blob);
    const a = document.createElement("a");
    a.href = url;
    a.download = construirNombreArchivo() + ".txt";
    a.click();
}
</script>
<script>
document.getElementById("inputCargarTXT").addEventListener("change", function(e) {
    const file = e.target.files[0];
    if (!file) return;

    const reader = new FileReader();
    reader.onload = function(ev) {
        const data = JSON.parse(ev.target.result);
        Object.keys(data).forEach(id => {
            const el = document.getElementById(id);
            if (el) el.value = data[id];
        });
        alert("Configuraci√≥n cargada");
    };
    reader.readAsText(file);
});
</script>

